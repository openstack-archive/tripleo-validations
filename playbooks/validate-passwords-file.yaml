---
- hosts: undercloud
  vars:
    metadata:
      name: Check Undercloud passwords file
      description: |
        Disallow updates if the passwords file is missing.
        If the undercloud was already deployed, the passwords file needs to be
        present so passwords that can't be changed are persisted.  If the file
        is missing it will break the undercloud, so we should fail-fast and let
        the user know about the problem.  Both the old and new path to the file
        is checked.  If either is found, the validation will pass as the old
        path will be migrated to the new during and update/upgrade.
      groups:
        - prep
        - pre-upgrade
        - pre-update
      categories:
        - os
      products:
        - tripleo
  roles:
    - validate_passwords_file
