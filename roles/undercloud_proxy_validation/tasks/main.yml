---

- name: Fail if no_proxy is not set
  fail:
    msg: >-
      http_proxy and/or https_proxy are set but no_proxy is not set.
      no_proxy needs to contain 127.0.0.1 or any of the undercloud
      public/private IPs otherwise deployment and/or upgrade will fail.
  failed_when: "item.stdout  == 'ActiveState=active'"
  when: (http_proxy|length > 0 or https_proxy|length > 0 is defined) and no_proxy|length == 0 or
        (HTTP_PROXY|length > 0 or HTTPS_PROXY|length > 0 is defined) and NO_PROXY|length == 0 or
