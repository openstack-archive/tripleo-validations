---
- name: Check pacemaker service is running
  become: true
  command: "/usr/bin/systemctl show pacemaker --property ActiveState"
  register: check_service
  changed_when: false
  ignore_errors: true

- name: Check pacemaker service is inactive or failed
  fail:
    msg: "Pacemaker service found {{ check_service.stdout.split('=')[-1] }}"
  when: check_service.stdout != 'ActiveState=active'

- when: "check_service.stdout == 'ActiveState=active'"
  block:
    - name: Get pacemaker status
      become: true
      command: pcs status xml
      register: pcs_status
      changed_when: false
    - name: Check pacemaker status
      pacemaker:
        status: "{{ pcs_status.stdout }}"
